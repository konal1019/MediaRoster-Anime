import{genres,searchAnime,getGenres}from"./api.c847ee31.js";import{escapeHTML,getSafeParams}from"./components/utils.af173b93.js";import{displaySearchResults}from"./components/search.5df5fdd2.js";export const status={searching:!1};export function initSlideshow(){let e=0;const t=document.querySelectorAll(".slide"),n=document.querySelector(".prev"),r=document.querySelector(".next");let s;function c(){t.forEach(e=>e.classList.remove("active")),e>=t.length&&(e=0),e<0&&(e=t.length-1),t[e].classList.add("active")}function i(){clearInterval(s),s=setInterval(()=>{e++,c()},5e3)}n&&r&&(n.addEventListener("click",()=>{e--,c(),i()}),r.addEventListener("click",()=>{e++,c(),i()}));const a=document.querySelector(".slideshow-container");let l=0,o=0;a.addEventListener("touchstart",e=>{l=e.changedTouches[0].screenX}),a.addEventListener("touchend",t=>{o=t.changedTouches[0].screenX,o<l&&(e++,c(),i()),o>l&&(e--,c(),i())}),c(),i()}export function initFlashcardHover(){function e(e){const t=e.querySelector(".flashcard-synopsis-overlay");t?(t.classList.add("fade-out"),t.addEventListener("transitionend",()=>{t.remove(),delete e.dataset.overlayAdded},{once:!0})):delete e.dataset.overlayAdded}function t(e){if(e.dataset.overlayAdded)return;e.dataset.overlayAdded="true";const t=e.dataset.synopsis,n=document.createElement("div");n.classList.add("flashcard-synopsis-overlay"),n.innerHTML=`\n      <p>${t}</p>\n    `,e.querySelector(".flashcard").appendChild(n)}document.querySelectorAll(".flashcard-link:not([data-hover-initialized])").forEach(n=>{"true"!=n.dataset.hoverInitialized&&(n.dataset.hoverInitialized="true",n.addEventListener("mouseenter",()=>t(n)),n.addEventListener("mouseleave",()=>e(n)),n.addEventListener("touchstart",()=>t(n)),n.addEventListener("touchend",()=>e(n)))})}export function initGalleryControls(){const e=document.querySelectorAll(".gallery-prev"),t=document.querySelectorAll(".gallery-next");e.forEach(e=>{e.addEventListener("click",()=>{const t=e.parentElement.querySelector(".horizontal-gallery");t&&t.scrollBy({left:-400,behavior:"smooth"})})}),t.forEach(e=>{e.addEventListener("click",()=>{const t=e.parentElement.querySelector(".horizontal-gallery");t&&t.scrollBy({left:400,behavior:"smooth"})})})}function hidePopup(){const e=document.getElementById("popup");e.hidden=!0,e.innerHTML=""}export function randomAnime(){document.getElementById("random-anime-button").addEventListener("click",()=>{Math.floor(100*Math.random())<1?triggerJumpscare():window.location.hash="#/details-random"})}function triggerJumpscare(){const e=document.querySelector("header"),t=document.querySelector("main"),n=document.querySelector("footer"),r=document.getElementById("loader");e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none"),r&&(r.style.display="none");const s=document.createElement("div");s.id="jumpscare-container";const c=document.createElement("img");c.src="./media/jumpscare.jpg",c.id="jumpscare-image";const i=new Audio("./media/jumpscare.mp3");s.appendChild(c),document.body.appendChild(s),s.requestFullscreen&&s.requestFullscreen(),i.play().catch(e=>console.error("Couldn't play jumpscare audio, maybe it's missing?")),setTimeout(()=>{document.exitFullscreen&&document.exitFullscreen(),s.remove(),window.location.href="./"},3e3)}export const activeFilters={};export function initFilters(){const e=document.querySelector(".filter-button"),t=document.querySelector(".filter-options"),n=document.querySelectorAll(".filter-btn"),r=document.querySelectorAll(".filter-input"),s=document.querySelectorAll(".filter-dropdown");e.addEventListener("click",()=>{t.style.display="none"===t.style.display?"grid":"none"}),n.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter,n=e.dataset.value;["season","status","type","rating"].includes(t)?(document.querySelectorAll(`.filter-btn[data-filter="${t}"]`).forEach(e=>e.classList.remove("active")),activeFilters[t]!==n?(activeFilters[t]=n,e.classList.add("active")):delete activeFilters[t]):activeFilters[t]&&activeFilters[t].includes(n)?(activeFilters[t]=activeFilters[t].filter(e=>e!==n),activeFilters[t].length||delete activeFilters[t],e.classList.remove("active")):(activeFilters[t]||(activeFilters[t]=[]),activeFilters[t].push(n),e.classList.add("active"))})}),r.forEach(e=>{e.addEventListener("input",()=>{const t=e.id,n=e.value;n?activeFilters[t]=n:delete activeFilters[t]})}),s.forEach(e=>{e.addEventListener("change",()=>{const t=e.id,n=e.value;n?activeFilters[t]=n:delete activeFilters[t]})});const c=document.getElementById("sfw-checkbox");c.addEventListener("change",()=>{c.checked&&activeFilters.sfw?(delete activeFilters.sfw,c.checked=!0,console.log("removed sfw")):(activeFilters.sfw="true",c.checked=!1),console.log(activeFilters)})}export async function renderGenres(){"{}"===JSON.stringify(genres)&&await getGenres();const e=Object.entries(genres).map(([e,t])=>`\n        <button class="genre-btn" data-filter="genres" data-value="${e}">${t}</button>\n    `).join("");document.getElementById("genresDiv").innerHTML+=e,document.querySelectorAll(".genre-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter,n=e.dataset.value;activeFilters[t]&&activeFilters[t].includes(n)?(activeFilters[t]=activeFilters[t].filter(e=>e!==n),activeFilters[t].length||delete activeFilters[t],e.classList.remove("active")):(activeFilters[t]||(activeFilters[t]=[]),activeFilters[t].push(n),e.classList.add("active"))})})}export async function initSearch(){applyFilters(),console.log(activeFilters);const e=document.getElementById("search-button");e&&e.addEventListener("click",()=>{delete activeFilters.page,constructURL(!0)});const t=document.getElementById("search-input");t.addEventListener("input",()=>{activeFilters.q=t.value}),t.addEventListener("keypress",e=>{"Enter"===e.key&&(delete activeFilters.page,constructURL(!0))});getSafeParams().toString()&&handleSearch(!1)}async function handleSearch(e=!0){const t=await constructURL(e);if(t){const e=await searchAnime(t);displaySearchResults(e)}}export async function constructURL(e=!1){const t=new URLSearchParams;for(const e in activeFilters){let n=activeFilters[e];"q"===e&&(n=n.replace(/[^\p{L}\p{N}\s\-_.:'"|#]/gu,"").slice(0,100)),Array.isArray(n)?t.append(e,n.join(",")):t.append(e,n)}if(!t.toString())return null;const n=`https://api.jikan.moe/v4/anime?${t.toString()}`;return e&&(window.location.hash=`#/search?${t.toString()}`),n}export function applyFilters(){for(const e in activeFilters)delete activeFilters[e];document.querySelectorAll('[class*="active"]').forEach(e=>e.classList.remove("active"));const e=getSafeParams();console.log(e);const t=["order_by","sort","min_score","max_score"];for(const[n,r]of e.entries())if("q"===n){const e=document.getElementById("search-input");e&&(e.value=r),activeFilters.q=r}else if("genres"===n)activeFilters[n]=[],r.split(",").forEach(e=>{const t=document.querySelector(`[data-filter='${n}'][data-value='${e}']`);t&&(t.classList.add("active"),activeFilters[n].push(e))});else if("page"===n)activeFilters[n]=r;else if("sfw"===n){const e=document.getElementById("sfw-checkbox");activeFilters.sfw="true",e.checked=!1}else if(t.includes(n)){const e=document.getElementById(n);e&&(e.value=r),activeFilters[n]=r}else{const e=document.querySelector(`[data-filter='${n}'][data-value='${r}']`);e&&e.classList.add("active"),activeFilters[n]=r}console.log(activeFilters)}